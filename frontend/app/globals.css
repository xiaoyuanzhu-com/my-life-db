@import "tailwindcss";
@import "tw-animate-css";
@plugin "@tailwindcss/typography";

@custom-variant dark (&:is(.dark *));

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
  --color-sidebar-ring: var(--sidebar-ring);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar: var(--sidebar);
  --color-chart-5: var(--chart-5);
  --color-chart-4: var(--chart-4);
  --color-chart-3: var(--chart-3);
  --color-chart-2: var(--chart-2);
  --color-chart-1: var(--chart-1);
  --color-ring: var(--ring);
  --color-input: var(--input);
  --color-border: var(--border);
  --color-destructive: var(--destructive);
  --color-accent-foreground: var(--accent-foreground);
  --color-accent: var(--accent);
  --color-muted-foreground: var(--muted-foreground);
  --color-muted: var(--muted);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-secondary: var(--secondary);
  --color-primary-foreground: var(--primary-foreground);
  --color-primary: var(--primary);
  --color-popover-foreground: var(--popover-foreground);
  --color-popover: var(--popover);
  --color-card-foreground: var(--card-foreground);
  --color-card: var(--card);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
}

:root {
  color-scheme: light;
  --radius: 0.625rem;
  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);
  --primary: oklch(0.205 0 0);
  --primary-foreground: oklch(0.985 0 0);
  --secondary: oklch(0.97 0 0);
  --secondary-foreground: oklch(0.205 0 0);
  --muted: oklch(0.97 0 0);
  --muted-foreground: oklch(0.556 0 0);
  --accent: oklch(0.97 0 0);
  --accent-foreground: oklch(0.205 0 0);
  --destructive: oklch(0.577 0.245 27.325);
  --border: oklch(0.922 0 0);
  --input: oklch(0.922 0 0);
  --ring: oklch(0.708 0 0);
  --chart-1: oklch(0.646 0.222 41.116);
  --chart-2: oklch(0.6 0.118 184.704);
  --chart-3: oklch(0.398 0.07 227.392);
  --chart-4: oklch(0.828 0.189 84.429);
  --chart-5: oklch(0.769 0.188 70.08);
  --sidebar: oklch(0.985 0 0);
  --sidebar-foreground: oklch(0.145 0 0);
  --sidebar-primary: oklch(0.205 0 0);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.97 0 0);
  --sidebar-accent-foreground: oklch(0.205 0 0);
  --sidebar-border: oklch(0.922 0 0);
  --sidebar-ring: oklch(0.708 0 0);

}

.dark {
  color-scheme: dark;
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.205 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.205 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.922 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.269 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.704 0.191 22.216);
  --border: oklch(1 0 0 / 10%);
  --input: oklch(1 0 0 / 15%);
  --ring: oklch(0.556 0 0);
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0.205 0 0);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.269 0 0);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(1 0 0 / 10%);
  --sidebar-ring: oklch(0.556 0 0);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}

/* Safe area support for mobile devices with notches */
@supports (padding: max(0px)) {
  .pb-safe {
    padding-bottom: max(0.75rem, env(safe-area-inset-bottom));
  }
}

/* Disable mobile touch behaviors that interfere with context menu */
@layer utilities {
  .touch-callout-none {
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
  }
}

/* Hide system text selection UI (handles, toolbar) while allowing visual selection */
::selection {
  background: rgb(180 180 255 / 30%);
}

/* Prevent selection handles and toolbar on mobile when context menu is open */
.mobile-menu-open {
  -webkit-user-select: text !important;
  user-select: text !important;
  -webkit-touch-callout: none !important;
}

.mobile-menu-open *::selection {
  background: rgb(180 180 255 / 30%);
}

/* Monaco editor rounded scrollbars */
.monaco-editor .scrollbar .slider {
  border-radius: 5px;
}

/* Content text - monospace font for user content (not UI labels) */
@layer utilities {
  .font-content {
    font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
  }
}

/* Pulse glow animation for bounding box highlight */
@keyframes pulse-glow {
  0%, 100% {
    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
  }
  50% {
    box-shadow: 0 0 12px 4px rgba(59, 130, 246, 0.8);
  }
}

.animate-pulse-glow {
  animation: pulse-glow 1s ease-in-out infinite;
  border: 2px solid rgba(59, 130, 246, 0.8);
  border-radius: 4px;
  background: rgba(59, 130, 246, 0.1);
}

/* Fade out animation for RLE mask canvas (burning ashes effect) */
@keyframes mask-fade-out {
  0% {
    opacity: 0.7;
  }
  100% {
    opacity: 0;
  }
}

.animate-mask-fade {
  animation: mask-fade-out 3s ease-out forwards;
}

/* Slide up and fade in animation for new inbox items */
@keyframes slide-up-fade {
  0% {
    opacity: 0;
    transform: translateY(20px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-slide-up-fade {
  animation: slide-up-fade 0.35s ease-out forwards;
}

/* Slide down and fade out animation for dismissing elements */
@keyframes slide-down-fade {
  0% {
    opacity: 1;
    transform: translateY(0);
  }
  100% {
    opacity: 0;
    transform: translateY(20px);
  }
}

.animate-slide-down-fade {
  animation: slide-down-fade 0.25s ease-in forwards;
}

.animate-slide-down-fade-slow {
  animation: slide-down-fade 0.4s ease-in forwards;
}

/* Banner reveal/conceal - CSS grid animation (GPU-accelerated) */
@keyframes banner-reveal {
  from { grid-template-rows: 0fr; }
  to { grid-template-rows: 1fr; }
}

.banner-grid {
  display: grid;
  grid-template-rows: 1fr;
  transition: grid-template-rows 0.25s ease-out;
  animation: banner-reveal 0.25s ease-out;
}

.banner-grid.concealing {
  grid-template-rows: 0fr;
}

.banner-grid-content {
  overflow: hidden;
}

/* Collapsible content using CSS Grid - smooth height transitions */
.collapsible-grid {
  display: grid;
  grid-template-rows: 1fr;
  transition: grid-template-rows 0.2s ease-out;
}

.collapsible-grid.collapsed {
  grid-template-rows: 0fr;
}

.collapsible-grid-content {
  overflow: hidden;
}

/* Initial hidden state for new items before animation starts */
.animate-new-item-initial {
  opacity: 0;
  transform: translateY(20px);
}

/* Collapse and fade out animation for deleted inbox items */
@keyframes collapse-fade {
  0% {
    opacity: 1;
    transform: scale(1);
    max-height: 500px;
    margin-bottom: 1rem;
  }
  50% {
    opacity: 0;
    transform: scale(0.95);
  }
  100% {
    opacity: 0;
    transform: scale(0.95);
    max-height: 0;
    margin-bottom: 0;
    padding: 0;
  }
}

.animate-collapse-fade {
  animation: collapse-fade 0.3s ease-out forwards;
  overflow: hidden;
}

/* Blink animation for typing cursor */
@keyframes blink {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0;
  }
}

.animate-blink {
  animation: blink 1s step-end infinite;
}

/* Streaming text fade+blur animation - words "materialize" into focus
   Used for smooth word appearance during LLM streaming */
@keyframes stream-fade-in {
  from {
    opacity: 0;
    filter: blur(4px);
  }
  to {
    opacity: 1;
    filter: blur(0);
  }
}

.animate-stream-word {
  animation: stream-fade-in 120ms ease-out forwards;
}

/* ============================================
   Claude Code Interface - Design System
   ============================================ */

/* Claude CSS Variables - globally available */
:root {
  /* Base Colors */
  --claude-bg-canvas: #FFFFFF;
  --claude-bg-subtle: #F5F4EE;
  --claude-bg-code-block: #F5F5F5;
  --claude-bg-inline: #F3F4F6;
  --claude-accent-edit: #FAF9F6;

  /* Typography Colors */
  --claude-text-primary: #1A1A1A;
  --claude-text-secondary: #5F6368;
  --claude-text-tertiary: #9CA3AF;
  --claude-text-system: #4A4A4A;

  /* Borders */
  --claude-border-light: #E5E7EB;

  /* Diff Colors */
  --claude-diff-add-bg: #E6FFEC;
  --claude-diff-add-fg: #22863A;
  --claude-diff-del-bg: #FFEBE9;
  --claude-diff-del-fg: #CB2431;

  /* Status Colors */
  --claude-status-alert: #D92D20;
  --claude-status-warn: #D97706;
}

.dark {
  --claude-bg-canvas: #1A1A1A;
  --claude-bg-subtle: #2A2A2A;
  --claude-bg-code-block: #252525;
  --claude-bg-inline: #2F2F2F;
  --claude-accent-edit: #2A2822;
  --claude-text-primary: #E8E8E8;
  --claude-text-secondary: #A8A8A8;
  --claude-text-tertiary: #6B6B6B;
  --claude-text-system: #B8B8B8;
  --claude-border-light: #404040;
  --claude-diff-add-bg: #1A3A1F;
  --claude-diff-add-fg: #6FD98F;
  --claude-diff-del-bg: #4A1F1F;
  --claude-diff-del-fg: #F97583;
  --claude-status-alert: #F97583;
  --claude-status-warn: #FFA657;
}

/* Claude background utility class */
.claude-bg {
  background: var(--claude-bg-canvas);
}

/* Claude interface typography/styling */
.claude-interface {
  font-family: Inter, system-ui, -apple-system, 'Segoe UI', sans-serif;
  font-size: 15px;
  line-height: 1.6;
  color: var(--claude-text-primary);
}

/* Claude Code Typography Utilities */
.claude-interface .font-mono {
  font-family: 'JetBrains Mono', 'Fira Code', 'SF Mono', Consolas, Menlo, monospace;
  font-feature-settings: 'liga' 1, 'calt' 1; /* Enable ligatures */
}

.claude-interface .text-body {
  font-size: 15px;
  line-height: 1.6;
  font-weight: 400;
}

.claude-interface .text-metadata {
  font-size: 13px;
  line-height: 1.4;
  font-weight: 400;
}

.claude-interface .text-code {
  font-size: 13px;
  line-height: 1.5;
  font-weight: 400;
}

/* Inline code styling */
.claude-interface code {
  background-color: var(--claude-bg-inline);
  color: var(--claude-text-primary);
  font-family: 'JetBrains Mono', 'Fira Code', 'SF Mono', Consolas, Menlo, monospace;
  font-size: 13px;
}

/* Code blocks */
.claude-interface pre {
  background-color: var(--claude-bg-code-block);
  font-family: 'JetBrains Mono', 'Fira Code', 'SF Mono', Consolas, Menlo, monospace;
  font-size: 13px;
  line-height: 1.5;
}

.claude-interface pre code {
  background-color: transparent;
}

/* Prose styling for markdown content in Claude chat */
.prose-claude {
  max-width: none;
  font-size: 15px;
  line-height: 1.6;
  user-select: text;
  color: var(--claude-text-primary);
}

.prose-claude p {
  margin: 1rem 0;
}

.prose-claude p:first-child {
  margin-top: 0;
}

.prose-claude h1 {
  font-size: 16px;
  font-weight: 700;
  line-height: 1.5;
  margin-bottom: 0.75rem;
  margin-top: 1rem;
}

.prose-claude h2 {
  font-size: 16px;
  font-weight: 600;
  line-height: 1.5;
  margin-bottom: 0.75rem;
  margin-top: 1rem;
}

.prose-claude h3 {
  font-size: 16px;
  font-weight: 600;
  line-height: 1.5;
  margin-bottom: 0.5rem;
  margin-top: 0.75rem;
}

.prose-claude ul {
  margin: 1rem 0;
  padding-left: 1.5rem;
  list-style-type: disc;
}

.prose-claude ol {
  margin: 1rem 0;
  padding-left: 1.5rem;
  list-style-type: decimal;
}

.prose-claude li {
  margin-bottom: 0.25rem;
}

.prose-claude code {
  font-family: 'JetBrains Mono', 'Fira Code', 'SF Mono', Consolas, Menlo, monospace;
  font-size: 13px;
  padding: 2px 5px;
  border-radius: 0.25rem;
  background-color: var(--claude-bg-inline);
}

.prose-claude code::before,
.prose-claude code::after {
  content: none;
}

.prose-claude pre {
  margin: 0.75rem 0;
  padding: 1rem;
  border-radius: 0.5rem;
  overflow-x: auto;
  background-color: var(--claude-bg-code-block);
}

.prose-claude pre code {
  padding: 0;
  background-color: transparent;
  font-size: 13px;
  line-height: 1.5;
}

.prose-claude strong {
  font-weight: 600;
}

.prose-claude a {
  text-decoration: underline;
  text-underline-offset: 2px;
}

.prose-claude table {
  margin: 1rem 0;
  width: 100%;
  border-collapse: collapse;
  border: 1px solid var(--claude-border-light);
}

.prose-claude .table-wrapper {
  overflow-x: auto;
  margin: 1rem 0;
}

.prose-claude .table-wrapper table {
  margin: 0;
  width: max-content;
  min-width: 100%;
}

.prose-claude thead {
  background-color: var(--claude-bg-subtle);
}

.prose-claude th {
  padding: 0.5rem 0.75rem;
  text-align: left;
  font-weight: 600;
  border: 1px solid var(--claude-border-light);
}

.prose-claude td {
  padding: 0.5rem 0.75rem;
  border: 1px solid var(--claude-border-light);
}

/* Shiki dual theme support - spans get color only, pre gets background */
.shiki span {
  color: var(--shiki-light) !important;
  background-color: transparent !important;
}

.dark .shiki span {
  color: var(--shiki-dark) !important;
}

/* Mermaid diagram styling */
.mermaid-diagram {
  margin: 1rem 0;
  display: flex;
  justify-content: center;
}

.mermaid-diagram svg {
  max-width: 100%;
  height: auto;
}

.mermaid-error {
  margin: 1rem 0;
  padding: 1rem;
  border: 1px solid var(--destructive);
  border-radius: 0.5rem;
  background: hsl(var(--destructive) / 0.1);
}

.mermaid-error pre {
  margin-bottom: 0.5rem;
}

.mermaid-loading,
.html-preview-loading {
  margin: 1rem 0;
  padding: 1rem;
  border: 1px dashed var(--border);
  border-radius: 0.5rem;
  background: var(--muted);
  text-align: center;
}

/* HTML preview iframe styling */
.html-preview-container {
  margin: 1rem 0;
  border: 1px solid var(--claude-border-light);
  border-radius: 0.5rem;
  overflow: hidden;
  background: white;
}

.html-preview-iframe {
  width: 100%;
  height: 60vh;
  border: none;
  display: block;
}
